#!/usr/bin/python
# Copyright: Ansible Project
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

from __future__ import absolute_import, division, print_function

__metaclass__ = type

DOCUMENTATION = """
module: deepsec_anti_malwares
short_description: Manages AntiMalware Rule resource module
description: Configure protection against malware, viruses, trojans and spyware.
version_added: 2.0.0
options:
  config:
    description: A dictionary of AntiMalware Rule Rules options
    type: list
    elements: dict
    suboptions:
      name:
        description: Name of the anti-malware configuration. Searchable as String.
        type: str
      description:
        description: Description of the anti-malware configuration. Searchable as
          String.
        type: str
      scan_type:
        description: The type of malware scan configuration. Searchable as Choice.
        type: str
        choices:
        - real-time
        - on-demand
      document_exploit_protection_enabled:
        description: Controls whether to scan for known critical vulnerabilities.
          Use true to enable scan.
        type: bool
      document_exploit_protection:
        description: Scan for exploits against known critical vulnerabilities only.
          Searchable as Choice.
        type: str
        choices:
        - critical-only
        - critical-and-heuristic
      document_exploit_heuristic_level:
        description: Controls whether to scan for exploits of known critical vulnerabilites
          as well as aggessively detect suspicious behaviour that could be an unknown
          exploit. Searchable as Choice.
        type: str
        choices:
        - default
        - default-and-agressive
        - LEVEL_THREE
        - LEVEL_FOUR
      machine_learning_enabled:
        description: Controls whether predictive machine learning is enabled.  Set
          to true to enable. Searchable as Boolean.
        type: bool
      behavior_monitoring_enabled:
        description: Controls whether to detect suspicious activity and unauthorized
          changes (including ransomware). Set to true to detect.
        type: bool
      document_recovery_enabled:
        description: Controls whether to back up ransomware-encrypted files. Set to
          true to back up. Searchable as Boolean.
        type: bool
      intelli_trap_enabled:
        description: Controls whether IntelliTrap is enabled. Set to true to enable.
          Searchable as Boolean.
        type: bool
      memory_scan_enabled:
        description: Controls whether to scan process memory for malware. Use true
          to enable scan. Searchable as Boolean.
        type: bool
      spyware_enabled:
        description: Controls whether to enable spyware/grayware protection. Set to
          true to enable. Searchable as Boolean.
        type: bool
      alert_enabled:
        description: Controls whether to create an alert when the Malware Scan Configuration
          logs an event. Set to true to enable the alert. Searchable as Boolean.
        type: bool
      directories_to_scan:
        description: Specify if the scan will be peformed on all the directories or
          on a subset. Searchable as Choice.
        type: str
        choices:
        - all-directories
        - directory-list
      directory_list_id:
        description: ID of the directory list to scan. Set to 0 to remove any assignment.
          Searchable as Numeric.
        type: int
      files_to_scan:
        description: Specify if scan will be performed on all files, a subset or by
          using IntelliScan. Searchable as Choice.
        type: str
        choices:
        - all-files
        - intelliscan-file-types
        - file-extension-list
      file_extension_list_id:
        description: ID of the file extension list to scan. Set to 0 to remove any
          assignment. Searchable as Numeric.
        type: int
      excluded_directory_list_id:
        description: ID of the directory list to exclude from the scan. Set to 0 to
          remove any assignment. Searchable as Numeric.
        type: int
      excluded_file_list_id:
        description: ID of the file list to exclude from the scan. Set to 0 to remove
          any assignment. Searchable as Numeric.
        type: int
      excluded_file_extension_list_id:
        description: ID of the file extension list to exclude from the scan. Set to
          0 to remove any assignment. Searchable as Numeric.
        type: int
      excluded_process_image_file_list_id:
        description: ID of the process image file list to exclude from the scan. Set
          to 0 to remove any assignment. Searchable as Numeric.
        type: int
      real_time_scan:
        description: Specify when to perform the real-time scan. Searchable as Choice.
        type: str
        choices:
        - read-only
        - write-only
        - read-write
      scan_compressed_enabled:
        description: Controls whether to scan compressed files. Use true to enable
          scan. Searchable as Boolean.
        type: bool
      scan_compressed_maximum_size:
        description: Maximum size of compressed files to scan, in MB. Searchable as
          Numeric.
        type: int
      scan_compressed_maximum_levels:
        description: The maximum number of levels of compression to scan. Searchable
          as Numeric.
        type: int
      scan_compressed_maximum_files:
        description: Maximum number of files to extract. Searchable as Numeric.
        type: int
      microsoft_office_enabled:
        description: Controls whether to scan Embedded Microsoft Office Objects. Use
          true to enable scan. Searchable as Boolean.
        type: bool
      microsoft_office_layers:
        description: Number of Microsoft Object Linking and Embedding (OLE) Layers
          to scan. Searchable as Numeric.
        type: int
      network_directories_enabled:
        description: Controls whether to scan network directories. Set to true to
          enable. Searchable as Boolean.
        type: bool
      custom_remediation_actions_enabled:
        description: Controls whether to use the action ActiveActions recommends when
          malware is detected. Set to true to use the action ActiveAction recommends.
        type: bool
      custom_scan_actions_enabled:
        description: Controls whether to use custom actions. Use true to enable custom
          actions. Available when 'customRemediationActionsEnabled' is true.
        type: bool
      scan_action_for_virus:
        description: The action to perform when a virus is detected. Searchable as
          Choice. Available when 'customScanActionsEnabled' is true.
        type: str
        choices:
        - pass
        - delete
        - quarantine
        - clean
        - deny-access
      scan_action_for_trojans:
        description: The action to perform when a trojan is detected. Searchable as
          Choice. Available when 'customScanActionsEnabled' is true.
        type: str
        choices:
        - pass
        - delete
        - quarantine
        - deny-access
      scan_action_for_packer:
        description: The action to perform when a packer is detected. Searchable as
          Choice. Available when 'customScanActionsEnabled' is true.
        type: str
        choices:
        - pass
        - delete
        - quarantine
        - deny-access
      scan_action_for_spyware:
        description: The action to perform when spyware is detected. Searchable as
          Choice. Available when 'customScanActionsEnabled' is true.
        type: str
        choices:
        - pass
        - delete
        - quarantine
        - deny-access
      scan_action_for_other_threats:
        description: The action to take when other threats are detected. Searchable
          as Choice. Available when 'customScanActionsEnabled' is true.
        type: str
        choices:
        - pass
        - delete
        - quarantine
        - clean
        - deny-access
      scan_action_for_cookies:
        description: The action to take when cookies are detected. Searchable as Choice.
          Available when 'customScanActionsEnabled' is true.
        type: str
        choices:
        - pass
        - delete
      scan_action_for_cve:
        description: The action to take when a CVE exploit is detected. Searchable
          as Choice. Available when 'customScanActionsEnabled' is true.
        type: str
        choices:
        - pass
        - delete
        - quarantine
        - deny-access
      scan_action_for_heuristics:
        description: The action to take when malware identified with heuristics are
          detected. Searchable as Choice. Available when 'customScanActionsEnabled'
          is true.
        type: str
        choices:
        - pass
        - delete
        - quarantine
        - deny-access
      scan_action_for_possible_malware:
        description: The action to take when possible malware is detected. Searchable
          as Choice. Available when 'customRemediationActionsEnabled' is true.
        type: str
        choices:
        - active-action
        - pass
        - delete
        - quarantine
        - deny-access
      amsi_scan_enabled:
        description: Controls whether Windows Antimalware Scan Interface (AMSI) protection
          is enabled. Set to true to enable.
        type: bool
      scan_action_for_behavior_monitoring:
        description: The action to take when suspicious activity and unauthorized
          changes are detected. Searchable as Choice. Available when 'behaviorMonitoringEnabled'
          is true.
        type: str
        choices:
        - active-action
        - pass
      scan_action_for_machine_learning:
        description: The action to take when malware identified with machine learning
          is detected. Searchable as Choice. Available when 'machineLearningEnabled'
          is true.
        type: str
        choices:
        - pass
        - delete
        - quarantine
      id:
        description: ID of the anti-malware configuration. This ID is set automatically.
          Searchable as ID.
        type: int
      cpu_usage:
        type: str
        choices:
        - low
        - medium
        - high
  state:
    description:
    - The state the configuration should be left in
    - The state I(gathered) will get the module API configuration from the device
      and transform it into structured data in the format as per the module argspec
      and the value is returned in the I(gathered) key within the result.
    type: str
    choices:
    - merged
    - replaced
    - gathered
    - deleted

author: Ansible Security Automation Team (@justjais) <https://github.com/ansible-security>
"""

EXAMPLES = """

# Using MERGED state
# -------------------

- name: Create AntiMalware Rules
  trendmicro.deepsec.deepsec_anti_malwares:
    state: merged
    config:
      - name: test_malware_1
        description: test malware 1 config
        scan_action_for_virus: pass
        alert_enabled: true
        scan_type: on-demand
        real_time_scan: read-only
        cpu_usage: medium
      - name: test_malware_2
        description: test malware 2 config
        scan_action_for_virus: pass
        alert_enabled: true
        scan_type: real-time
        real_time_scan: read-write
        cpu_usage: low

# Play Run:
# =========
#
# "intrusion_preventionrules": {
#     "after": [
#         {
#             "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR 2 DESCRIPTION",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 7887,
#             "name": "TEST IPR 1",
#             "priority": "normal",
#             "severity": "medium",
#             "signature": "test_new_signature_1",
#             "template": "signature"
#         },
#         {
#             "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR 2 DESCRIPTION",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 7888,
#             "name": "TEST IPR 2",
#             "priority": "normal",
#             "severity": "medium",
#             "signature": "test_new_signature_2",
#             "template": "signature"
#         }
#     ],
#     "before": []
# }

- name: Modify existing AntiMalware Rules
  trendmicro.deepsec.deepsec_anti_malwares:
    state: merged
    config:
      - name: test_malware_2
        description: Update test malware 2 description
        scan_type: on-demand

# Play Run:
# =========
#
# "intrusion_preventionrules": {
#     "after": [
#         {
#            "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 7902,
#             "name": "TEST IPR 2",
#             "priority": "normal",
#             "severity": "low",
#             "signature": "test_new_signature",
#             "template": "signature"
#          }
#     ],
#     "before": [
#         {
#            "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 7902,
#             "name": "TEST IPR 2",
#             "priority": "normal",
#             "severity": "medium",
#             "signature": "test_new_signature",
#             "template": "signature"
#          }
#     ]
# }

# Using REPLACED state
# --------------------

- name: Replaced AntiMalware Rules
  trendmicro.deepsec.deepsec_firewall_rules:
    state: replaced
    config:
      - name: test_malware_2
        description: Replace test malware 2 description
        scan_action_for_virus: pass
        alert_enabled: true
        scan_type: on-demand
        real_time_scan: read-only
        cpu_usage: medium

# Play Run:
# =========
#
#  "intrusion_prevention_rules": {
#     "after": [
#         {
#             "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR 1 REPLACE DESCRIPTION",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 8151,
#             "name": "TEST IPR 1",
#             "priority": "normal",
#             "severity": "low",
#             "signature": "test_new_signature_1",
#             "template": "signature"
#         },
#         {
#             "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR 2 REPLACE DESCRIPTION",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 8152,
#             "name": "TEST IPR 2",
#             "priority": "normal",
#             "severity": "low",
#             "signature": "test_new_signature_1",
#             "template": "signature"
#         }
#     ],
#     "before": [
#         {
#             "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR 1 DESCRIPTION",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 8149,
#             "name": "TEST IPR 1",
#             "priority": "normal",
#             "severity": "medium",
#             "signature": "test_new_signature_1",
#             "template": "signature"
#         },
#         {
#             "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR 2 DESCRIPTION",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 8150,
#             "name": "TEST IPR 2",
#             "priority": "normal",
#             "severity": "medium",
#             "signature": "test_new_signature_2",
#             "template": "signature"
#         }
#     ]

# Using GATHERED state
# --------------------

- name: Gather AntiMalware Rules by AntiMalware names
  trendmicro.deepsec.deepsec_anti_malwares:
    state: gathered
    config:
      - name: test_malware_1
      - name: test_malware_2

# Play Run:
# =========
#
# "gathered": [
#     {
#         "action": "drop",
#         "alert_enabled": false,
#         "always_include_packet_data": false,
#         "application_type_id": 300,
#         "case_sensitive": false,
#         "debug_mode_enabled": false,
#         "description": "TEST IPR 2 DESCRIPTION",
#         "detect_only": false,
#         "event_logging_disabled": false,
#         "generate_event_on_packet_drop": true,
#         "id": 7887,
#         "name": "TEST IPR 1",
#         "priority": "normal",
#         "severity": "medium",
#         "signature": "test_new_signature_1",
#         "template": "signature"
#     },
#     {
#         "action": "drop",
#         "alert_enabled": false,
#         "always_include_packet_data": false,
#         "application_type_id": 300,
#         "case_sensitive": false,
#         "debug_mode_enabled": false,
#         "description": "TEST IPR 2 DESCRIPTION",
#         "detect_only": false,
#         "event_logging_disabled": false,
#         "generate_event_on_packet_drop": true,
#         "id": 7888,
#         "name": "TEST IPR 2",
#         "priority": "normal",
#         "severity": "medium",
#         "signature": "test_new_signature_2",
#         "template": "signature"
#     }
# ]

- name: Gather ALL of the AntiMalware Rules
  trendmicro.deepsec.deepsec_anti_malwares:
    state: gathered

# Using DELETED state
# ------------------

- name: Delete AntiMalware Rules
  trendmicro.deepsec.deepsec_firewall_rules:
    state: deleted
    config:
      - name: test_malware_1
      - name: test_malware_2

# Play Run:
# =========
#
# "intrusion_preventionrules": {
#     "after": [],
#     "before": [
#         {
#             "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR 2 DESCRIPTION",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 7887,
#             "name": "TEST IPR 1",
#             "priority": "normal",
#             "severity": "medium",
#             "signature": "test_new_signature_1",
#             "template": "signature"
#         },
#         {
#             "action": "drop",
#             "alert_enabled": false,
#             "always_include_packet_data": false,
#             "application_type_id": 300,
#             "case_sensitive": false,
#             "debug_mode_enabled": false,
#             "description": "TEST IPR 2 DESCRIPTION",
#             "detect_only": false,
#             "event_logging_disabled": false,
#             "generate_event_on_packet_drop": true,
#             "id": 7888,
#             "name": "TEST IPR 2",
#             "priority": "normal",
#             "severity": "medium",
#             "signature": "test_new_signature_2",
#             "template": "signature"
#         }
#     ]
# }

"""

RETURN = """
before:
  description: The configuration as structured data prior to module invocation.
  returned: always
  type: list
  sample: The configuration returned will always be in the same format of the parameters above.
after:
  description: The configuration as structured data after module completion.
  returned: when changed
  type: list
  sample: The configuration returned will always be in the same format of the parameters above.
"""
