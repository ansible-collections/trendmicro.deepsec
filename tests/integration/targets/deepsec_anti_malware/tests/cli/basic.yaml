---
- debug: msg="START cli/basic.yaml"

- block:
    - name: Configure AntiMalware config
      register: result
      trendmicro.deepsec.deepsec_anti_malware: &id001
        name: test_malware_1
        description: test malware config
        scan_action_for_virus: pass
        alert_enabled: true
        scan_type: real-time
        real_time_scan: read-write
        cpu_usage: low
        state: present

    - assert:
        that:
          - result.changed == true

    - name: Configure AntiMalware config (IDEMPOTENT)
      register: result
      trendmicro.deepsec.deepsec_anti_malware: *id001

    - assert:
        that:
          - result.changed == false

    - name: Should not match for test_malware_1
      register: result
      trendmicro.deepsec.deepsec_anti_malware:
        name: test_malware_2
        description: test new malware config
        scan_action_for_virus: pass
        alert_enabled: true
        scan_type: real-time
        real_time_scan: read-write
        cpu_usage: low
        state: present

    - assert:
        that:
          - result.changed == true

    - name: teardown
      register: result
      trendmicro.deepsec.deepsec_anti_malware:
        state: absent
        name: test_malware_1

    - assert:
        that:
          - result.changed == true

    - name: teardown
      register: result
      trendmicro.deepsec.deepsec_anti_malware:
        state: absent
        name: test_malware_2

    - assert:
        that:
          - result.changed == true

    - name: teardown idempotency check
      register: result
      trendmicro.deepsec.deepsec_anti_malware:
        state: absent
        name: test_malware_1

    - assert:
        that:
          - result.changed == false
  always:
    - name: teardown test_malware_1
      trendmicro.deepsec.deepsec_anti_malware:
        state: absent
        name: test_malware_1
    - name: teardown test_malware_2
      trendmicro.deepsec.deepsec_anti_malware:
        state: absent
        name: test_malware_2

- debug: msg="END cli/basic.yaml"
